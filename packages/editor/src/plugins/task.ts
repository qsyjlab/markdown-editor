import { MarkdownEditor } from "../editor";
import { generateSvg } from "../icon";
import { EditorPlugin } from "../plugin";

import "../style/ui/input.scss";
import { generateMarkdownTaskList } from "../utils/generate";

export function taskPlugin(editor: MarkdownEditor): EditorPlugin {
  const name = "task";

  editor.iconManager.register({
    name,
    type: "html",
    html: generateSvg(
      '<path d="M426.666667 725.333333a42.666667 42.666667 0 0 1 42.666666-42.666666h384a42.666667 42.666667 0 1 1 0 85.333333h-384a42.666667 42.666667 0 0 1-42.666666-42.666667zM368.64 607.232a42.666667 42.666667 0 0 1 5.461333 60.074667l-106.666666 128a42.666667 42.666667 0 0 1-56.448 8.192l-64-42.666667a42.666667 42.666667 0 1 1 47.36-70.997333l32.085333 21.418666 82.133333-98.56a42.666667 42.666667 0 0 1 60.074667-5.461333zM426.666667 512a42.666667 42.666667 0 0 1 42.666666-42.666667h384a42.666667 42.666667 0 1 1 0 85.333334h-384a42.666667 42.666667 0 0 1-42.666666-42.666667zM368.64 393.898667a42.666667 42.666667 0 0 1 5.461333 60.074666l-106.666666 128a42.666667 42.666667 0 0 1-56.448 8.192l-64-42.666666a42.666667 42.666667 0 0 1 47.36-70.997334l32.085333 21.418667 82.133333-98.56a42.666667 42.666667 0 0 1 60.074667-5.461333zM426.666667 298.666667a42.666667 42.666667 0 0 1 42.666666-42.666667h384a42.666667 42.666667 0 1 1 0 85.333333h-384a42.666667 42.666667 0 0 1-42.666666-42.666666zM368.64 180.565333a42.666667 42.666667 0 0 1 5.461333 60.074667l-106.666666 128a42.666667 42.666667 0 0 1-56.448 8.192l-64-42.666667a42.666667 42.666667 0 1 1 47.36-70.997333l32.085333 21.418667 82.133333-98.56a42.666667 42.666667 0 0 1 60.074667-5.461334z"></path>'
    ),
  });

  editor.toolbarManager?.register({
    name,
    icon: name,
    label: "任务",
    onAction: () => {
      const taskText = generateMarkdownTaskList([
        { name: "任务", completed: true },
      ]);

      editor.insert(({ start }) => {
        return {
          formattedText: `\n${taskText}\n`,
          start,
          end: start,
        };
      });
    },
  });

  return {
    name,
  };
}
